---
title: "Portfolio 8"
name: "Cat Seitz"
date: "3.21.2023"
data: "Thesis analysis - adult data - distractor location rt and accuracy"
output: 
  html_document: 
    theme: cerulean
---

```{r load-packages, message=FALSE}
library(tidyverse) 
library(tidyr)
library(rstatix)
library(data.table)
library(afex)
library(emmeans)
library(psych)
library(ggprism)
library(patchwork)
library(magrittr)
library(cowplot)
```

I put all the messy loading in of different data sets and adding in important columns to an R script instead of having it here. 
```{r, include=FALSE}

source("load_data.R", local = knitr::knit_global())

```

### Trim the Data

Define trimming criteria according to Van Selst and Jolicoeur 1994.
```{r set_stds_depending_on_set_size}
xsize <- c(4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 20, 
             25, 30, 35, 50, 100)
stds <- c(1.458, 1.68, 1.841, 1.961, 2.05, 2.12, 2.173, 
            2.22, 2.246, 2.274, 2.31, 2.326, 2.391, 2.41, 2.4305, 
            2.45, 2.48, 2.5)
```

Trim the data and compute the percent trimmed
```{r trimming-adults}
trimmedA <- adults[adults$acc==1, ] %>% group_by(id, relative_hp_dist) %>%
           mutate(sdc = ifelse(length(rt)>=100,2.5,approx(xsize,stds,xout=length(rt))$y), avg = mean(rt), stdev = sd(rt)) %>%
           filter(rt <= sdc*stdev+avg & rt >=avg-(sdc*stdev) & rt >=.200) %>%
           select(id, relative_hp_dist, rt, block_num) %>%  #keep these columns in the new data frame
           as.data.frame()


statPrep <- trimmedA %>% group_by(id, relative_hp_dist) %>% summarise(measurement=mean(rt)) %>% as.data.frame()
100-(nrow(trimmedA)/nrow(adults[adults$acc==1, ]))*100
```
2.88% of trials were trimmed from the adult data set. 

```{r trimming-child12}
trimmedC12 <- kids12[kids12$acc==1, ] %>% group_by(id, relative_hp_dist) %>%
           mutate(sdc = ifelse(length(rt)>=100,2.5,approx(xsize,stds,xout=length(rt))$y), avg = mean(rt), stdev = sd(rt)) %>%
           filter(rt <= sdc*stdev+avg & rt >=avg-(sdc*stdev) & rt >=.200) %>%
           select(id, relative_hp_dist, rt, block_num1) %>%  #keep these columns in the new data frame
           as.data.frame()


statPrep <- trimmedC12 %>% group_by(id, relative_hp_dist) %>% summarise(measurement=mean(rt)) %>% as.data.frame()
100-(nrow(trimmedC12)/nrow(kids12[kids12$acc==1, ]))*100
```
2.78% of trials were trimmed from the older child data set. 

```{r trimming-child6}
trimmedC6 <- kids6[kids6$acc==1, ] %>% group_by(id, relative_hp_dist) %>%
           mutate(sdc = ifelse(length(rt)>=100,2.5,approx(xsize,stds,xout=length(rt))$y), avg = mean(rt), stdev = sd(rt)) %>%
           filter(rt <= sdc*stdev+avg & rt >=avg-(sdc*stdev) & rt >=.200) %>%
           select(id, relative_hp_dist, rt, block_num2) %>%  #keep these columns in the new data frame
           as.data.frame()


statPrep <- trimmedC6 %>% group_by(id, relative_hp_dist) %>% summarise(measurement=mean(rt)) %>% as.data.frame()
100-(nrow(trimmedC6)/nrow(kids6[kids6$acc==1, ]))*100
```
6.07% of trials were trimmed from the younger child data set.


### Response Time ANOVA for 3 conditions and 2 ages

```{r change-column-names}

kids12<- kids12 %>%
  rename(
    block_num=block_num1,
    age=age1
  )

kids6<- kids6 %>%
  rename(
    block_num=block_num2,
    age=age2
  )


```


 
```{r combine-columns}

all_data <- rbind(adults, kids12)
 
```

Create a new data frame with the average RT for each relative distractor location per participant, so we can do a repeated measures ANOVA -- eventually -- maybe. 

```{r smaller df for 1 line per condition per participant}

space <- all_data %>%
  group_by(age, id, relative_hp_dist) %>%
  summarize(rts = mean(rt)
            )
space
  
```

Run ANOVA on 3 conditions first, and if significant, then run in on 5 conditions?

Need to reformat the above df to have a column for each relative_hp_dist/ID so we can average across low-probability locations. 

```{r reformat}

space_anova <- setDT(space)
space_anova <- dcast(space_anova,id+age~relative_hp_dist,value.var='rts')

```

```{r set up data for t-test for high and low conditions only}

space_anova <- space_anova %>%
  mutate(low_prob = (lp_1+lp_2+lp_3)/3)

```

Now, I want to create a smaller graph with just 3 bars: one for the high-probability rts, average of low-probability rts, and no distractor. 

```{r get_info_for_smaller_figure}

df_mod <- subset(space_anova, select=c(id, age, high_prob, absent, low_prob))

df_mod <- reshape2::melt(df_mod, id.var=c('id', 'age'), variable.name= "relative_hp_dist")

```

Plot data. 

```{r plot-first}
ggplot(df_mod, aes(relative_hp_dist, value, fill=relative_hp_dist)) +
  geom_bar(stat="summary", fun.y="mean", position="dodge") + 
  facet_grid(.~age) +
  xlab("Distractor Location") + ylab("Response Times (ms)") +
  scale_fill_brewer(palette="Dark2") +
  theme(legend.position="none")

```

Run a 3x2 mixed design ANOVA with distractor location and age as independent variables and rt as the dependent variable. 

```{r ANOVA}

model3 <- aov_car(value ~ age*relative_hp_dist + Error(id/relative_hp_dist), data=df_mod)

model3

```

The effect of age was significant F(1,31)=8, p=.008.The effect of distractor location was significant, F(2, ??)= 25.2, p<.001. The interaction was significant, F=4.28, p=.025.

### Separate ANOVA for just adults

```{r smaller df for 1 line per condition per participant}

spaceA <- adults %>%
  group_by(id, relative_hp_dist) %>%
  summarize(rts = mean(rt)
            )
  
```

Run ANOVA on 3 conditions first, and if significant, then run in on 5 conditions?

Need to reformat the above df to have a column for each relative_hp_dist/ID so we can average across low-probability locations. 

```{r reformat}

space_anovaA <- setDT(spaceA)
space_anovaA <- dcast(space_anovaA,id~relative_hp_dist,value.var='rts')

```

```{r set up data for t-test for high and low conditions only}

space_anovaA <- space_anovaA %>%
  mutate(low_prob = (lp_1+lp_2+lp_3)/3)

```

Now, I want to create a smaller graph with just 3 bars: one for the high-probability rts, average of low-probability rts, and no distractor. 

```{r get_info_for_smaller_figure}

df_modA <- subset(space_anovaA, select=c(id, high_prob, absent, low_prob))

df_modA <- reshape2::melt(df_modA, id.var=c('id'), variable.name= "relative_hp_dist")

```

```{r ANOVA}

modelA <- aov_car(value ~ relative_hp_dist + Error(id/relative_hp_dist), data=df_modA)

modelA

```

The repeated measures ANOVA on just the adults was significant. 

```{r last_anova_test}

model_dist_rtsA <- aov_car(rts ~ relative_hp_dist + Error(id/relative_hp_dist), data=spaceA)

model_dist_rtsA


```

Run t-test to determine significant differences between conditions. 

```{r t-test}

space_anovaA %>%
  t.test(x=space_anovaA$low_prob, y=space_anovaA$high_prob, alternative="greater", mu=0,paired = TRUE, conf.level = .95) 
space_anovaA%>%
  t.test(x=space_anovaA$high_prob, y=space_anovaA$absent, alternative="greater", mu=0, paired =TRUE, conf.level = .95) 
space_anovaA%>%
  t.test(x=space_anovaA$low_prob, y=space_anovaA$absent, alternative="greater", mu=0, paired =TRUE, conf.level = .95)

```

### Separate ANOVA for just kids


```{r smaller df for 1 line per condition per participant}

spaceK <- kids12 %>%
  group_by(id,relative_hp_dist) %>%
  summarize(rts = mean(rt)
            )

```

Run ANOVA on 3 conditions first, and if significant, then run in on 5 conditions?

Need to reformat the above df to have a column for each relative_hp_dist/ID so we can average across low-probability locations. 

```{r reformat}

space_anovaK <- setDT(spaceK)
space_anovaK <- dcast(space_anovaK,id~relative_hp_dist,value.var='rts')

```

```{r set up data for t-test for high and low conditions only}

space_anovaK <- space_anovaK %>%
  mutate(low_prob = (lp_1+lp_2+lp_3)/3)

```

Now, I want to create a smaller graph with just 3 bars: one for the high-probability rts, average of low-probability rts, and no distractor. 

```{r get_info_for_smaller_figure}

df_modK <- subset(space_anovaK, select=c(id,high_prob, absent, low_prob))

df_modK <- reshape2::melt(df_modK, id.var=c('id'), variable.name= "relative_hp_dist")

```

```{r ANOVA}

modelK <- aov_car(value ~ relative_hp_dist + Error(id/relative_hp_dist), data=df_modK)

modelK

```

The repeated measures ANOVA on just the kids was also significant.

```{r last_anova_test}

model_dist_rtsK <- aov_car(rts ~ relative_hp_dist + Error(id/relative_hp_dist), data=spaceK)

model_dist_rtsK


```

Run t-test to determine significant differences between conditions. 

```{r t-test}

space_anovaK %>%
  t.test(x=space_anovaK$low_prob, y=space_anovaK$high_prob, alternative="greater", mu=0,paired = TRUE, conf.level = .95) 
space_anovaK%>%
  t.test(x=space_anovaK$high_prob, y=space_anovaK$absent, alternative="greater", mu=0, paired =TRUE, conf.level = .95) 
space_anovaK%>%
  t.test(x=space_anovaK$low_prob, y=space_anovaK$absent, alternative="greater", mu=0, paired =TRUE, conf.level = .95)

```


Run an ANOVA on rts for all 5 conditions if the ANOVA on the 3 conditions was significant. 






### Examine accuracies

Due to participants having extremely high accuracy overall, I expect there to be no differences. 
