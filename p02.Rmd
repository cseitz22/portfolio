---
title: "Portfolio 2"
name: "Cat Seitz"
date: "1.31.2023"
data: "Distractor Suppression Pilot Study"
---

```{r load-packages, message=FALSE}
library(tidyverse) 
library(tidyr)
library(rstatix)
library(data.table)
```

The data used is from a visual search task in which participants are searching for a unique item in an array of six items and press a button to indicate whether the item is facing right or left. On 50% of trials, a salient, color distractor is present in the array. On 67% of distractor present trials, the distractor appears in the same location in the array with an equal number of trials in the other 5 locations. This study is testing whether adults can learn to suppress their attention to the high-probabilty location of the distractor. 

The goal of this portfolio is to examine the effects of distractor location on accuracy and target location on response time and accuracy. 

```{r import_data}

pilot <- read_csv("p02/pilot_final.csv", show_col_types = FALSE)

pilot$relative_hp_dist[pilot$relative_hp_dist == 10] <- "no_dist"
pilot$relative_hp_dist[pilot$relative_hp_dist == 0] <- "dist_0"
pilot$relative_hp_dist[pilot$relative_hp_dist == 1] <- "dist_1"
pilot$relative_hp_dist[pilot$relative_hp_dist == 2] <- "dist_2"
pilot$relative_hp_dist[pilot$relative_hp_dist == 3] <- "dist_3"
pilot$RT <- pilot$RT *1000
  
```

### Target Location Effects on Response Time

Added in the block column at this point just in case I want to use it in the future. 

```{r add_column_for_trial_block}

block_num <- rep(c(1,2,3,4,5,6,7,8), each=60, times=21)
pilot <- cbind(pilot, block_num)

```

Added in a column for how the target related to the high-probability distractor location. Used brute force instead of trying to write a fancy function. 

```{r add_column_for_target_distance_from_the_high_probability_location}

pilot <- pilot %>%
  mutate(relative_target=
           case_when(target_loc=="loc1" & high_prob==1 ~ 0,
                     target_loc=="loc2" & high_prob==1 ~ 1,
                     target_loc=="loc3" & high_prob==1 ~ 2,
                     target_loc=="loc4" & high_prob==1 ~ 3,
                     target_loc=="loc5" & high_prob==1 ~ 2,
                     target_loc=="loc6" & high_prob==1 ~ 1,
                     target_loc=="loc1" & high_prob==2 ~ 1,
                     target_loc=="loc2" & high_prob==2 ~ 0,
                     target_loc=="loc3" & high_prob==2 ~ 1,
                     target_loc=="loc4" & high_prob==2 ~ 2,
                     target_loc=="loc5" & high_prob==2 ~ 3,
                     target_loc=="loc6" & high_prob==2 ~ 2,
                     target_loc=="loc1" & high_prob==3 ~ 2,
                     target_loc=="loc2" & high_prob==3 ~ 1,
                     target_loc=="loc3" & high_prob==3 ~ 0,
                     target_loc=="loc4" & high_prob==3 ~ 1,
                     target_loc=="loc5" & high_prob==3 ~ 2,
                     target_loc=="loc6" & high_prob==3 ~ 3,
                     target_loc=="loc1" & high_prob==4 ~ 3,
                     target_loc=="loc2" & high_prob==4 ~ 2,
                     target_loc=="loc3" & high_prob==4 ~ 1,
                     target_loc=="loc4" & high_prob==4 ~ 0,
                     target_loc=="loc5" & high_prob==4 ~ 1,
                     target_loc=="loc6" & high_prob==4 ~ 2,
                     target_loc=="loc1" & high_prob==5 ~ 2,
                     target_loc=="loc2" & high_prob==5 ~ 3,
                     target_loc=="loc3" & high_prob==5 ~ 2,
                     target_loc=="loc4" & high_prob==5 ~ 1,
                     target_loc=="loc5" & high_prob==5 ~ 0,
                     target_loc=="loc6" & high_prob==5 ~ 1,
                     target_loc=="loc1" & high_prob==6 ~ 1,
                     target_loc=="loc2" & high_prob==6 ~ 2,
                     target_loc=="loc3" & high_prob==6 ~ 3,
                     target_loc=="loc4" & high_prob==6 ~ 2,
                     target_loc=="loc5" & high_prob==6 ~ 1,
                     target_loc=="loc6" & high_prob==6 ~ 0,))

```

Create new data frame with the mean response times grouped by distractor location relative to the high-probability location and add columns for standard error. 

```{r create new df with mean rts}

target_means <- pilot %>%
  group_by(relative_target) %>%
  filter(acc==100) %>%
  summarize(mean_rts=mean(RT),
            sd_rt=sd(RT),
            n_rt=21,
            se=sd_rt/sqrt(n_rt),
            upper_limit=mean_rts+se,
            lower_limit=mean_rts-se
  )
target_means

```

This figure displays the mean response times depending on the location of the target relative to the high probability location of the distractor. I chose those particular colors based on Wake Forest's color scheme. 


```{r - graph 1 - distractor location effect on rt}
ggplot(data = target_means, aes(x = relative_target, y = mean_rts)) +
  geom_bar(stat = "identity", fill="#9E7E38", color='#000000') +
  geom_errorbar(aes(ymin=lower_limit, ymax=upper_limit), width=0.2)+
  coord_cartesian(ylim = c(700,1000))+
  theme_classic()+
  labs(x = "Target Location Relative to High-probability Distractor Location", y = "Response Time (ms)")+
  labs(title = "Target Location Effect on RT")+
  labs(caption = "An ANOVA test shows a difference in RT depending on target location, F(3,60)=12.93, p<.001.")
  
```

Create a new data frame with the average RT for each relative distractor location per participant, so we can do a repeated measures ANOVA. 

```{r smaller df for 1 line per condition per participant}

space <- pilot %>%
  group_by(ID, relative_target) %>%
  filter(acc==100) %>%
  summarize(rts = mean(RT),
            )
space
  
```

Need to reformat the above df to have a column for each relative_hp_dist/ID.

```{r}

space_anova <- setDT(space)
space_anova <- dcast(space_anova,ID~relative_target,value.var='rts')

```

``` {r testing assumptions}

#first identify outliers - not sure what to do with them anyway so overall just ignore? maybe reason enough to get rid of ppt 11? ppt 11 was problematic in most tests
space %>%
  group_by(relative_target) %>%
  identify_outliers(rts)


#testing the normality assumption -- data is normally distributed enough because no conditions have a p-value less than .05
space %>%
  group_by(relative_target) %>%
  shapiro_test(rts)

```

Assumption of sphericity is automatically checked during the ANOVA test. Next, we'll do the ANOVA test. The ANOVA shows a significant difference among distractor locations, F(1.74,34.86)=12.925, p<.001.


```{r ANOVA test}

res.aov <- anova_test(data = space, dv = rts, wid = ID, within = relative_target)
get_anova_table(res.aov)

```

I ran the ANOVA using base R as well because the rstatix package was giving me errors when running for accuracy data later on. The rstatix packages has a lot of requests and hasn't been updated in years so I switched to a different route to get the same results. 

```{r anova_target_rt}

model = aov(rts~factor(relative_target)+
                Error(factor(ID)), data=space)
summary(model)

```

### Distractor and Target Location Effects on Accuracy


```{r create_accuracy_df}

pilot_distacc <- pilot %>%
  group_by(relative_hp_dist) %>%
  summarize(accuracy = mean(acc),
            sd_rt=sd(acc),
            n_rt=21,
            se=sd_rt/sqrt(n_rt),
            upper_limit=accuracy+se,
            lower_limit=accuracy-se
            )
pilot_targacc <- pilot %>%
  group_by(relative_target) %>%
  summarize(accuracy = mean(acc),
            sd_rt=sd(acc),
            n_rt=21,
            se=sd_rt/sqrt(n_rt),
            upper_limit=accuracy+se,
            lower_limit=accuracy-se
            )



```

```{r - graph distractor location effects on accuracy}
ggplot(data = pilot_distacc, aes(x = relative_hp_dist, y = accuracy)) +
  geom_bar(stat = "identity", fill="#9E7E38", color='#000000') +
  geom_errorbar(aes(ymin=lower_limit, ymax=upper_limit), width=0.2)+
  coord_cartesian(ylim = c(85,105))+
  theme_classic()+
  labs(x = "Distractor Location Relative to High-probability Distractor Location", y = "Accuracy (%)")+
  labs(title = "Distractor Location Effect on Accuracy")+
  labs(caption = "An ANOVA test shows a difference in accuracy depending on distractor location, F(4,80)=3.24, p=.016.")

```

```{r - graph target location effects on accuracy}
ggplot(data = pilot_targacc, aes(x = relative_target, y = accuracy)) +
  geom_bar(stat = "identity", fill="#9E7E38", color='#000000') +
  geom_errorbar(aes(ymin=lower_limit, ymax=upper_limit), width=0.2)+
  coord_cartesian(ylim = c(85,105))+
  theme_classic()+
  labs(x = "Target Location Relative to High-probability Distractor Location", y = "Accuracy (%)")+
  labs(title = "Target Location Effect on Accuracy")+
  labs(caption = "An ANOVA test shows a difference in accuracy depending on target location, F(3,60)=4.55, p=.006.")

```

```{r create_accuracy_df_for_ANOVAs}

pilot_dist <- pilot %>%
  group_by(ID, relative_hp_dist) %>%
  summarize(accuracy = mean(acc)
            )
pilot_dist
```

```{r accuracy_target}

pilot_targ <- pilot %>%
  group_by(ID, relative_target) %>%
  summarize(accuracy = mean(acc)
            )

pilot_targ

```

```{r anova_distractor_accuracy}

model = aov(accuracy~factor(relative_hp_dist)+
                Error(factor(ID)), data=pilot_dist)
summary(model)

```


```{r anova_target_accuracy}

model = aov(accuracy~factor(relative_target)+
                Error(factor(ID)), data=pilot_targ)
summary(model)

```

